(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"751+":function(e,i,t){"use strict";t.r(i),t.d(i,"DevicePageModule",function(){return f});var o=t("ofXK"),r=t("3Pt+"),n=t("TEn/"),c=t("tyNb"),s=t("mrSG"),a=t("sObM"),d=t("RqmV"),l=t("fXoL"),b=t("wkY0");function h(e,i){1&e&&(l.Nb(0,"ion-item"),l.Nb(1,"ion-label"),l.ec(2,"service"),l.Mb(),l.Mb())}const u=[{path:"",component:(()=>{class e{constructor(e,i,t,o){this.route=e,this.router=i,this.toastCtrl=t,this.firmwareService=o,this.isFirstUpdateCheck=!0,this.route.queryParams.subscribe(e=>{this.router.getCurrentNavigation().extras.state&&(this.device=this.router.getCurrentNavigation().extras.state.device,console.log("UUIDs: "+this.device.uuids))})}ngOnInit(){this.isFirstUpdateCheck=!0,this.readVersion().then(()=>{this.getFirmwareVersions()})}disconnect(){a.a.disconnect(this.device.deviceId).then(()=>{console.log("Disconnected from device "),this.router.navigate([""])}).catch(e=>{console.error("Unable to disconnect "+e)})}readVersion(){return Object(s.a)(this,void 0,void 0,function*(){const e=yield a.a.read(this.device.deviceId,d.a.OTA_SERVICE_UUID,d.a.VERSION_CHAR_UUID);this.hardwareVersion="v"+e.getUint8(0)+"."+e.getUint8(1),this.softwareVersion="v"+e.getUint8(2)+"."+e.getUint8(3)+"."+e.getUint8(4),console.log("Hardware-Version: "+this.hardwareVersion),console.log("Software-Version: "+this.softwareVersion)})}getFirmwareVersions(){this.firmwareService.getVersioninfo().subscribe(e=>{console.log("Firmware: "+JSON.stringify(e)),this.checkForUpdate(e)})}checkForUpdate(e){let i=0,t=e.firmware[i].software;e:for(;void 0!==t;){let o="N/A",r=0;for(;void 0!==o;){if(void 0===e.firmware[i])break e;if(o=e.firmware[i].hardware[r++],o===this.hardwareVersion){if(t=e.firmware[i].software,t!==this.softwareVersion)return console.log("latest compatible version: "+t),void this.promptForUpdate(!0,t);break e}}i++}this.isFirstUpdateCheck?this.isFirstUpdateCheck=!1:this.promptForUpdate(!1,this.softwareVersion)}promptForUpdate(e,i){return Object(s.a)(this,void 0,void 0,function*(){let t;t=e?yield this.toastCtrl.create({header:"Compatible update available - version "+i,message:"Do you want to update your rESCue device?",position:"middle",color:"warning",animated:!0,buttons:[{icon:"checkmark-circle",text:"Yes",handler:()=>{console.log("Update clicked"),this.router.navigate(["/update"],{state:{deviceId:this.device.deviceId,version:i}})}},{icon:"close-circle",text:"No",role:"cancel",handler:()=>{console.log("Cancel clicked")}}]}):yield this.toastCtrl.create({header:"No compatible update available!",message:"Your device is already running the latest version "+i,color:"primary",position:"middle",buttons:[{text:"OK",role:"cancel"}]}),t.present()})}}return e.\u0275fac=function(i){return new(i||e)(l.Kb(c.a),l.Kb(c.g),l.Kb(n.u),l.Kb(b.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["app-device"]],decls:31,vars:5,consts:[[4,"ngFor","ngForOf"],["outline","","color","secondary"],["name","key"],["name","close-circle"],["outline","","color","warning",3,"click"],["name","construct"],["outline","","color","danger",3,"click"],["name","bluetooth"]],template:function(e,i){1&e&&(l.Nb(0,"ion-header"),l.Nb(1,"ion-toolbar"),l.Nb(2,"ion-title"),l.ec(3,"Your rESCue device"),l.Mb(),l.Mb(),l.Mb(),l.Nb(4,"ion-content"),l.Nb(5,"ion-card"),l.Nb(6,"ion-card-header"),l.Nb(7,"ion-card-subtitle"),l.ec(8),l.Mb(),l.Nb(9,"ion-card-title"),l.ec(10),l.Mb(),l.Mb(),l.Nb(11,"ion-card-content"),l.Nb(12,"p"),l.ec(13),l.Mb(),l.Nb(14,"p"),l.ec(15),l.Mb(),l.Nb(16,"ion-list"),l.dc(17,h,3,0,"ion-item",0),l.Mb(),l.Mb(),l.Nb(18,"ion-chip",1),l.Lb(19,"ion-icon",2),l.Nb(20,"ion-label"),l.ec(21,"Set Auth-Token"),l.Mb(),l.Lb(22,"ion-icon",3),l.Mb(),l.Nb(23,"ion-chip",4),l.Ub("click",function(){return i.getFirmwareVersions()}),l.Lb(24,"ion-icon",5),l.Nb(25,"ion-label"),l.ec(26,"Check for update"),l.Mb(),l.Mb(),l.Nb(27,"ion-chip",6),l.Ub("click",function(){return i.disconnect()}),l.Lb(28,"ion-icon",7),l.Nb(29,"ion-label"),l.ec(30,"Disconnect"),l.Mb(),l.Mb(),l.Mb(),l.Mb()),2&e&&(l.Ab(8),l.fc("rESCue device ",i.device.deviceId,""),l.Ab(2),l.fc("Name: ",i.device.name,""),l.Ab(3),l.fc("Hardware-Version: ",i.hardwareVersion,""),l.Ab(2),l.fc("Firmware-Version: ",i.softwareVersion,""),l.Ab(2),l.Yb("ngForOf",i.device.uuids))},directives:[n.j,n.r,n.q,n.i,n.c,n.e,n.f,n.g,n.d,n.n,o.h,n.h,n.k,n.m,n.l],styles:[""]}),e})()}];let p=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=l.Ib({type:e}),e.\u0275inj=l.Hb({imports:[[c.i.forChild(u)],c.i]}),e})(),f=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=l.Ib({type:e}),e.\u0275inj=l.Hb({imports:[[o.b,r.a,n.s,p]]}),e})()}}]);
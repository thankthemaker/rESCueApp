(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{xPwt:function(t,e,i){"use strict";i.r(e),i.d(e,"UpdatePageModule",function(){return p});var s=i("ofXK"),n=i("3Pt+"),r=i("TEn/"),o=i("tyNb"),a=i("mrSG"),c=i("sObM"),u=i("RqmV"),d=i("fXoL"),h=i("wkY0");const l=[{path:"",component:(()=>{class t{constructor(t,e,i,s){this.route=t,this.router=e,this.toastCtrl=i,this.firmwareService=s,this.progress="0%",this.progressNum=0,this.route.queryParams.subscribe(t=>{this.router.getCurrentNavigation().extras.state&&(this.deviceId=this.router.getCurrentNavigation().extras.state.deviceId,this.version=this.router.getCurrentNavigation().extras.state.version)})}ngOnInit(){this.firmwareService.getFirmwareFile(this.version).subscribe(t=>{this.updateDevice(t)})}updateDevice(t){return Object(a.a)(this,void 0,void 0,function*(){let e=t.byteLength;console.log("started update to version "+this.version),console.log("filesize bytes "+e),this.updateData=t,this.sendFileOverBluetooth()})}delay(t){return Object(a.a)(this,void 0,void 0,function*(){return new Promise(e=>setTimeout(e,t))})}updateFinished(t){return Object(a.a)(this,void 0,void 0,function*(){const e=yield this.toastCtrl.create({header:t?"Update finished":"Update failed",message:"Your update was "+(t?"successful, please restart your device.":"not successful."),position:"middle",color:t?"success":"danger",animated:!0,buttons:[{text:"OK",role:"ok"}]});yield e.present(),yield e.onDidDismiss(),this.router.navigate([""])})}sendFileOverBluetooth(){this.totalSize=this.updateData.byteLength,this.remaining=this.totalSize,this.amountToWrite=0,this.currentPosition=0,c.a.startNotifications(this.deviceId,u.a.OTA_SERVICE_UUID,u.a.FILE_CHAR_UUID,this.sendBufferedData.bind(this)),this.sendBufferedData()}sendBufferedData(){console.log("sendBufferedData: "),this.remaining>0&&(this.amountToWrite=this.remaining>=512?512:this.remaining,this.dataToSend=this.updateData.slice(this.currentPosition,this.currentPosition+this.amountToWrite),this.currentPosition+=this.amountToWrite,this.remaining-=this.amountToWrite,console.log("remaining: "+this.remaining),c.a.write(this.deviceId,u.a.OTA_SERVICE_UUID,u.a.FILE_CHAR_UUID,this.dataToSend),this.progressNum=this.currentPosition/this.totalSize,this.progress=(100*this.progressNum).toPrecision(3)+"%")}}return t.\u0275fac=function(e){return new(e||t)(d.Kb(o.a),d.Kb(o.g),d.Kb(r.u),d.Kb(h.a))},t.\u0275cmp=d.Eb({type:t,selectors:[["app-update"]],decls:13,vars:2,consts:[["id","container"],[3,"value"]],template:function(t,e){1&t&&(d.Nb(0,"ion-header"),d.Nb(1,"ion-toolbar"),d.Nb(2,"ion-title"),d.ec(3,"Updating your rESCue device"),d.Mb(),d.Mb(),d.Mb(),d.Nb(4,"ion-content"),d.Nb(5,"div",0),d.Nb(6,"strong"),d.ec(7,"Updating your rESCue device!"),d.Mb(),d.Nb(8,"p"),d.ec(9,"Please be patient, the update might take several minutes."),d.Mb(),d.Nb(10,"p"),d.Lb(11,"ion-progress-bar",1),d.ec(12),d.Mb(),d.Mb(),d.Mb()),2&t&&(d.Ab(11),d.Zb("value",e.progressNum),d.Ab(1),d.fc(" Progress: ",e.progress," "))},directives:[r.j,r.r,r.q,r.i,r.o],styles:["#container[_ngcontent-%COMP%]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:20px;line-height:26px}#container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}"]}),t})()}];let g=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.Ib({type:t}),t.\u0275inj=d.Hb({imports:[[o.i.forChild(l)],o.i]}),t})(),p=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.Ib({type:t}),t.\u0275inj=d.Hb({imports:[[s.b,n.a,r.s,g]]}),t})()}}]);